/* jPictura v1.2.3, Core v0.1.4 */
var jpictura={core:{}};jpictura.core.debounce=function(a,n,o){var r;return function(){var t=this,e=arguments,i=o&&!r;clearTimeout(r),r=setTimeout(function(){r=null,o||a.apply(t,e)},n),i&&a.apply(t,e)}},jpictura.core.offWindowWidthResize=function(t){jQuery(window).off("."+t)},jpictura.core.onWindowWidthResize=function(t,e){var i=jQuery(window),a=i.width();i.on("resize."+t,function(){var t=i.width();a!==t&&(e(),a=t)})},jpictura.core.heightCalculator=function(t,e,i){function a(t){var e,i,a,n,o,r;n=t,o=h.layout.idealRowHeight,r=h.layout.maxWidthHeightRatio,l=n/(n/o+r),e=t,i=h.layout.idealRowHeight,a=h.layout.maxWidthHeightRatio,u=e<=a*i?(h.debug&&c("The max width/height ratio "+a+" is too big for row width "+e+"px."),e*a):e/((e+0)/i-a),s()}function s(){o=(l+u)/2}var l,u,o,c=e,r=t,h=i;this.getHeight=function(t,e){if(0===t.length)return 0;a(e);var i=function(t,e){for(var i,a,n=0;e<(i=r(t,o,!1,h))?u=o:l=o,s(),a=e<i?!0:!1,e-i>h.algorithm.epsilon&&(a=!0),++n>=h.algorithm.maxIterationCount&&(a=!1),a;);return n>=h.algorithm.maxIterationCount&&h.debug&&c("Max "+n+" iterations reached. Current precision: "+(e-i)+"."),o}(t,e);return function(t,e,i){for(t=Math.floor(t);r(e,t,!0,h)<i&&t++;);return t}(i,t,e)}},function(f){function i(t,e){t.addClass(e.classes.container),t.toggleClass("stretch-images",e.layout.stretchImages),t.toggleClass("center-images",e.layout.centerImages),t.toggleClass("disable-cropping-images",!e.layout.allowCropping),t.toggleClass("fade-in-items",e.effects.fadeInItems);var i,a,n,o,r=t.find(e.selectors.item);r.addClass(e.classes.item),r.find(e.selectors.image).addClass(e.classes.image),i=t,a=r,o=s,(n=e).waitForImages?function(o,r,s,l){function a(t,e){var i,a,n=e.width/e.height;i=n,a=c+"-ratio",t.data(a,i),++u===r.size()&&l(o,r,s)}var u=0;r.each(function(){var t=f(this),e=t.find(s.selectors.image),i=new Image;i.src=e.attr("src"),f(i).load(function(){a(t,i)})})}(i,a,n,o):o(i,a,n)}function s(t,e,i){var a=jpictura.core.debounce(function(){!function(t,e,i){m(t,0);var a,n=(new Date).getTime(),o=0,r=[];do{e.addClass(i.classes.invisible),e.addClass(i.classes.hidden);var s=y(t);r.push(s);var l,u,c=!1;3<=r.length&&(l=r[r.length-3],(u=r[r.length-2])<l&&l===s&&(s=u,c=!0)),function(t,e,o){var r=[],s=t-2*o.layout.rowPadding,l=new o.heightCalculator(W,R,o);e.each(function(){var t,e,i,a,n=f(this);0===r.length||((t=r.slice(0)).push(n),p(t,s,o)&&(e=w(r,s,l,o),i=w(t,s,l,o),a=f.fn.jpictura.evaluate(e,o),f.fn.jpictura.evaluate(i,o)<a||(v(r,s,e,!1,o),r=[]))),r.push(n)});var i=p(r,s,o)||o.layout.justifyLastRow?w(r,s,l,o):o.layout.idealRowHeight;v(r,s,i,!0,o)}(Math.floor(s),e,i);var h,d=y(t);r.push(d),a=!1,s!==d&&(h=r[r.length-2],a=!c||h!==d)}while(a&&++o<=10);var g=(new Date).getTime();10<o&&i.debug?R("Max redraw tries of 10reached. Gallery redraw failed."):i.debug&&R("Gallery redrawn in "+(g-n)+" milliseconds."),m(t,null)}(t,e,i)},i.responsive.debounce);(function(e,i,t){jpictura.core.offWindowWidthResize(c),t.responsive.enabled&&t.responsive.onWindowWidthResize&&jpictura.core.onWindowWidthResize(c,e);var a=c+"-resize-interval",n=i.data(a);{var o;clearInterval(n),i.data(a,null),t.responsive.enabled&&t.responsive.onContainerWidthResize&&(o=y(i),n=setInterval(function(){var t=y(i);t!==o&&(o=t,e())},t.responsive.containerResizeInterval),i.data(a,n))}})(a,t,i),a()}function m(t,e){t.data(c+"-redraw-progress",e)}function p(t,e,i){for(var a=(t.length-1)*i.layout.itemSpacing,n=0;n<t.length;n++)a+=b(t[n],i.layout.idealRowHeight,i);return e<a}function w(t,e,i,a){var n=I(t,e,a);return i.getHeight(t,n)}function v(t,e,i,a,n){for(var o,r,s,l,u,c,h,d,g,f,m,p,w=W(t,i,!0,n),v=I(t,e,n),y={row:t,width:e,height:i,isLastRow:a,itemsSpaceWidth:v,itemsWidthDelta:w-v,unassignedItemsWidthDelta:w-v},R=(m=n,(p=t.slice(0)).sort(function(t,e){return j(e,!0,m)-j(t,!0,m)}),p),C=0;C<R.length;C++)o=R[C],s=n,0,l=(r=y).row,u=r.isLastRow,c=o===l[0],h=o===l[l.length-1],d=function(t,e,i){var a=b(t,e.height,i),n=function(t,e){if(e.unassignedItemsWidthDelta<=0)return 0;var i=Math.ceil(t/e.itemsSpaceWidth*e.itemsWidthDelta);return e.unassignedItemsWidthDelta<i&&(i=e.unassignedItemsWidthDelta),e.unassignedItemsWidthDelta-=i,i}(a,e);return Math.floor(a)-n}(o,r,s),g=r.height,f=o.find(s.selectors.image),function(t,e,i){t.width(e),t.height(i)}(o,d,g),function(t,e){t.removeClass(e.classes.invisible),t.removeClass(e.classes.hidden)}(o,s),function(t,e,i,a,n){t.toggleClass(n.classes.lastRow,e),t.toggleClass(n.classes.firstInRow,i),t.toggleClass(n.classes.lastInRow,a)}(o,u,c,h,s),function(t,e,i,a){var n={left:"",right:""};a.layout.applyRowPadding&&(n.left=(e?a.layout.rowPadding:0)+"px",n.right=(i?a.layout.rowPadding:0)+"px"),t.css("margin-left",n.left),t.css("margin-right",n.right)}(o,c,h,s),function(t,e,i,a){var n={right:"",bottom:""};a.layout.applyItemSpacing&&(n.right=(e?0:a.layout.itemSpacing)+"px",n.bottom=(i?0:a.layout.itemSpacing)+"px"),t.css("margin-right",n.right),t.css("margin-bottom",n.bottom)}(o,h,u,s),function(t,e,i,a){var n=j(t,!1,a)*i;t.toggleClass("stretch-by-height",e<=n),t.toggleClass("stretch-by-width",n<e);var o=function(t,e,i){return Math.abs(t-e)>i.layout.croppingEpsilon}(n,e,a);t.toggleClass("cropped-if-stretched",o)}(o,d,g,s),function(t,e,i){t.toggleClass("horizontal-misfit",function(t,e){return 1<Math.abs(t.width()-e)}(t,e)),t.toggleClass("vertical-misfit",function(t,e){return 1<Math.abs(t.height()-e)}(t,i))}(f,d,g)}function W(t,e,i,a){for(var n=0,o=0;o<t.length;o++){var r=b(t[o],e,a);i&&(r=Math.floor(r)),n+=r}return n}function I(t,e,i){return e-(t.length-1)*i.layout.itemSpacing}function b(t,e,i){return j(t,!0,i)*e}function j(t,e,i){var a,n,o,r,s=c+"-ratio",l=t.data(s);if(void 0===l&&(o=function(t,e){var i=c+"-width",a=t.data(i);{var n;void 0===a&&(n=t.find(e.selectors.image),a=n.prop("naturalWidth"),t.data(i,a))}return a}(a=t,n=i),r=function(t,e){var i=c+"-height",a=t.data(i);{var n;void 0===a&&(n=t.find(e.selectors.image),a=n.prop("naturalHeight"),t.data(i,a))}return a}(a,n),l=o/r,t.data(s,l)),e){if(l<=i.layout.minWidthHeightRatio)return i.layout.minWidthHeightRatio;if(l>=i.layout.maxWidthHeightRatio)return i.layout.maxWidthHeightRatio}return l}function y(t){return parseFloat(window.getComputedStyle(t[0],null).getPropertyValue("width"))}function R(t){window.console&&console.log(e+": "+t)}f.fn.jpictura=function(t){var e=f.extend(!0,{},f.fn.jpictura.defaults,t);return this.each(function(){i(f(this),e)}),this};var e="jPictura",c=e.toLowerCase();f.fn.jpictura.defaults={selectors:{item:".item",image:"img"},classes:{container:c,item:c+"-item",image:c+"-image",lastRow:c+"-last-row",firstInRow:c+"-first-in-row",lastInRow:c+"-last-in-row",invisible:c+"-invisible",hidden:c+"-hidden",offContentFlow:c+"-off-content-flow"},layout:{rowPadding:0,applyRowPadding:!0,itemSpacing:5,applyItemSpacing:!0,idealRowHeight:180,minWidthHeightRatio:1/3,maxWidthHeightRatio:3,stretchImages:!0,allowCropping:!0,croppingEpsilon:3,centerImages:!0,justifyLastRow:!1},effects:{fadeInItems:!1},responsive:{enabled:!0,onWindowWidthResize:!0,onContainerWidthResize:!0,containerResizeInterval:50,debounce:200},waitForImages:!0,heightCalculator:jpictura.core.heightCalculator,algorithm:{epsilon:.01,maxIterationCount:50},debug:!1},f.fn.jpictura.evaluate=function(t,e){return Math.abs(t-e.layout.idealRowHeight)}}(jQuery);